<!-- Blog Modal Overlay -->
<div class="fixed inset-0 bg-transparent backdrop-blur-[2px] flex justify-center items-start sm:items-center z-50 p-4 sm:p-5 overflow-y-auto modal-overlay" *ngIf="visible" @modalAnimation (click)="onOverlayClick($event)">
  <div class="mt-10 mb-10 sm:my-0 bg-gradient-to-br from-surface/95 via-surface/85 to-surface-alt/70 border border-divider/60 rounded-2xl p-4 sm:p-6 max-w-[95vw] sm:max-w-[85vw] lg:max-w-4xl w-full max-h-none sm:max-h-[92vh] overflow-y-auto relative shadow-2xl shadow-black/50 ring-1 ring-base/40" (click)="$event.stopPropagation()">
    <!-- Close button -->
    <button class="absolute top-3 right-3 bg-transparent border-none text-secondary cursor-pointer p-2 rounded hover:text-primary hover:bg-surface-alt transition-colors z-10" (click)="close()" aria-label="Close modal">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>

    <!-- Post title -->
    <h2 class="text-lg sm:text-2xl font-semibold text-primary mb-5 pr-8 sm:pr-10 tracking-tight flex items-start gap-3">
      <span class="inline-block w-1 h-6 rounded bg-accent mt-0.5"></span>
      <span>{{ post?.title }}</span>
    </h2>

    <!-- Image display -->
    <div class="relative mb-5" *ngIf="post?.images && post!.images!.length > 0">
      <!-- Main image -->
    <div class="text-center mb-2.5 rounded-xl overflow-hidden border border-base/40 bg-black/20">
        <img
          [src]="getModalImageUrls(post!.images![currentImageIndex]).src"
          [srcset]="getModalImageUrls(post!.images![currentImageIndex]).srcset"
          [sizes]="getModalImageUrls(post!.images![currentImageIndex]).sizes"
          [alt]="post!.title + ' - Image ' + (currentImageIndex + 1)"
      class="max-w-full max-h-[60vh] sm:max-h-[70vh] object-contain"
          loading="lazy" />
      </div>

      <!-- Navigation arrows (only show if more than 1 image) -->
      <button
        class="absolute top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 border-none text-white w-8 h-8 sm:w-10 sm:h-10 rounded-full cursor-pointer flex items-center justify-center transition-all hover:bg-opacity-70 disabled:opacity-50 disabled:cursor-not-allowed z-5 left-2 sm:left-2.5"
        (click)="prevImage()"
        [disabled]="currentImageIndex === 0"
        *ngIf="post!.images!.length > 1"
        aria-label="Previous image">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>

      <button
        class="absolute top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 border-none text-white w-8 h-8 sm:w-10 sm:h-10 rounded-full cursor-pointer flex items-center justify-center transition-all hover:bg-opacity-70 disabled:opacity-50 disabled:cursor-not-allowed z-5 right-2 sm:right-2.5"
        (click)="nextImage()"
        [disabled]="currentImageIndex === post!.images!.length - 1"
        *ngIf="post!.images!.length > 1"
        aria-label="Next image">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>

      <!-- Image indicators -->
      <div class="flex justify-center gap-2 mt-2.5" *ngIf="post!.images!.length > 1">
        <button
          *ngFor="let image of post!.images!; let i = index"
          class="w-2 h-2 rounded-full border-none border-base cursor-pointer transition-colors hover:border-strong"
          [class.bg-accent]="i === currentImageIndex"
          (click)="goToImage(i)"
          [attr.aria-label]="'Go to image ' + (i + 1)">
        </button>
      </div>
    </div>

  <!-- Post description -->
  <div class="mb-4 prose prose-invert max-w-none text-secondary text-sm sm:text-base" *ngIf="post?.description" [innerHTML]="post!.description | markdown"></div>

    <!-- Post tags -->
    <div class="flex flex-wrap gap-2 mb-4" *ngIf="post?.tags && post!.tags!.length > 0">
      <span *ngFor="let tag of post!.tags!" class="bg-accent/90 hover:bg-accent text-white px-2 py-1 rounded-full text-xs tracking-wide uppercase transition-colors">{{ tag }}</span>
    </div>

    <!-- Post date -->
    <div class="text-right" *ngIf="post?.created_at">
  <!-- created_at stored as seconds; convert to milliseconds for date pipe -->
  <p class="text-faint text-xs sm:text-sm m-0">{{ (post!.created_at! * 1000) | date:'mediumDate' }}</p>
    </div>
  </div>
</div>
